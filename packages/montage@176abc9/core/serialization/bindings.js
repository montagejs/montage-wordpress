var Bindings=require("frb"),stringify=require("frb/stringify"),assign=require("frb/assign"),evaluate=require("frb/evaluate"),expand=require("frb/expand"),Scope=require("frb/scope"),Serializer=require("../serialization/serializer/montage-serializer").MontageSerializer,Deserializer=require("../serialization/deserializer/montage-deserializer").MontageDeserializer,ONE_ASSIGNMENT="=",ONE_WAY="<-",TWO_WAY="<->",serializeObjectBindings=exports.serializeObjectBindings=function(e,i){for(var r,n,a=Bindings.getBindings(i),t={},s=a.keys();n=s.next().value;){var o=a.get(n),l={};if((!("serializable"in o)||o.serializable)&&o.sourceSyntax){var c,d=o.sourcePath,g=o.sourceSyntax;if(o.source&&o.source!==i){var u=e.getObjectLabel(o.source);c=new Scope({type:"component",label:u}),c.components=e,g=expand(g,c)}c=new Scope,c.components=e,d=stringify(g,c),o.twoWay?l[TWO_WAY]=d:l[ONE_WAY]=d,o.converter?l.converter=o.converter:(l.convert=o.convert,l.revert=o.revert),o.trace&&(l.trace=!0),t[n]=l,r=!0}}return r?t:void 0};Serializer.defineSerializationUnit("bindings",serializeObjectBindings);var deserializeObjectBindings=exports.deserializeObjectBindings=function(e,i,r){var n,a,t={components:e};for(n in r){if(a=r[n],"object"!=typeof a){if(n.indexOf(".")===-1)throw new Error("Binding descriptor must be an object, not "+typeof a);a={"=":""+a}}if(ONE_ASSIGNMENT in a){var s=a[ONE_ASSIGNMENT];assign(i,n,"string"==typeof s?evaluate(s,i,null,null,e):s,null,null,e)}else Bindings.defineBinding(i,n,a,t)}};Deserializer.defineDeserializationUnit("bindings",deserializeObjectBindings);