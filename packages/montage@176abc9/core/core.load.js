montageDefine("176abc9","core/core",{dependencies:["collections/shim","./shim/object","./shim/array","./extras/object","./extras/date","./extras/element","./extras/function","./extras/regexp","./extras/string","proxy-polyfill/proxy.min","collections/map","collections/weak-map","collections/set","collections/listen/property-changes","frb","frb/parse","frb/evaluate","frb/assign","frb/bind","frb/compile-observer","frb/scope","frb/observers","./promise","./serialization/bindings"],factory:function(e,t,r){function n(e,t,r){var o=r||(t===O?T:y+t+g);return e!==Object.prototype?e.hasOwnProperty(o)?e[o]:Object.defineProperty(e,o,{enumerable:!1,configurable:!1,writable:!0,value:Object.create(n(Object.getPrototypeOf(e),t,o))})[o]:(q.has(t)||q.set(t,{}),q.get(t))}function o(e){var t=J.get(e);return t||J.set(e,t=new h),t}function i(e,t,r){var n,a,l,c=x,s=Object.getOwnPropertyDescriptor(e,t);if(s)if(typeof s.value===_&&typeof r.value===_)for(c["delete"](s.value),n=o(s.value),a=n.values();l=a.next().value;)c["delete"](l);else{if(typeof s.get===_&&typeof r.get===_)for(c["delete"](s.get),n=o(s.get),a=n.values();l=a.next().value;)c["delete"](l);if(typeof s.set===_&&typeof r.set===_)for(c["delete"](s.set),n=o(s.set),a=n.values();l=a.next().value;)c["delete"](l)}if(n=L.get(e))for(a=n.values();l=a.next().value;)i(l,t,r)}function a(e){var t=L.get(e);return t||L.set(e,t=new h),t}function l(e,t,r,n,o,i,l){var c,s,u,p,f,d,b,h,g,y,v=global.Object,m=o,P=i,j=l;for(b=g=r?t:t.prototype;!y&&null!==g;){if(d){if(p=v.getOwnPropertyDescriptor(g,d)){if(p.hasOwnProperty("value")){f=p.value,y=!0;break}if(P&&p.hasOwnProperty("get")){f=p.get,y=!0;break}if(j&&p.hasOwnProperty("set")){f=p.set,y=!0;break}}}else for(c=n?(U[0]=n)&&U:v.getOwnPropertyNames(g),s=0;u=c[s];s++)if(p=v.getOwnPropertyDescriptor(g,u))if(f=p.value,void 0!==f&&null!==f){if(f===e||f.deprecatedFunction===e){d=u,m=!0;break}}else{if(f=p.get,void 0!==f&&null!==f&&(f===e||f.deprecatedFunction===e)){d=u,P=!0;break}if(f=p.set,void 0!==f&&null!==f&&(f===e||f.deprecatedFunction===e)){d=u,j=!0;break}}h=g,(g=v.getPrototypeOf(g))&&a(g).add(h)}return y&&typeof f===_?f:Function.noop}function c(e,t,r,n,i){if(e||t){var a=x.get(e);if(!a){var c=typeof this===_;a=l(e,c?this:this.constructor,c,t,r,n,i),a&&(x.set(e,a),o(a).add(e))}return a}}function s(){var e=s&&s.caller?s.caller:arguments.callee.caller,t=c.call(this,e);return t?t.apply(this,arguments):void 0}function u(e){var t=u&&u.caller?u.caller:arguments.callee.caller,r=c.call(this,t,e,!0,!1,!1);return r?r.bind(this):Function.noop}function p(e){var t=p&&p.caller?p.caller:arguments.callee.caller,r=c.call(this,t,e,!1,!0,!1);return r?r.bind(this):Function.noop}function f(e){var t=f&&f.caller?f.caller:arguments.callee.caller,r=c.call(this,t,e,!1,!1,!0);return r?r.bind(this):Function.noop}e("collections/shim"),e("./shim/object"),e("./shim/array"),e("./extras/object"),e("./extras/date"),e("./extras/element"),e("./extras/function"),e("./extras/regexp"),e("./extras/string"),e("proxy-polyfill/proxy.min");var d=e("collections/map"),b=e("collections/weak-map"),h=e("collections/set"),g="AttributeProperties",y="_",v="__proto__",m="value",P="enumerable",j="distinct",O="serializable",_="function",w=95,D=Array.prototype,C=Object.prototype,I=C.hasOwnProperty,F={get:void 0,set:void 0,configurable:!1,enumerable:!1},M={value:void 0,configurable:!1,enumerable:!1,writable:!1},x=new b,L=new b;if(!Object.create.name){var z=/^[\S\s]*?function\s*/,B=/[\s\(\/][\S\s]+$/;Object.defineProperty(Function.prototype,"name",{get:function(){var e="";return this===Function||this===Function.prototype.constructor?e="Function":this!==Function.prototype&&(e=(""+this).replace(z,"").replace(B,"")),e}})}var A=t.Montage=function(){},E={}.__proto__===Object.prototype,N={_montage_metadata:1,__state__:1,_hasUserDefinedConstructor:1};if(A.defineValueProperty=function ae(e,t,r,n,o,i){ae.template.value=r,ae.template.configurable=n,ae.template.enumerable=o,ae.template.writable=i,this.defineProperty(e,t,ae.template)},A.defineValueProperty.template=M,A.defineAccessorProperty=function le(e,t,r,n,o,i){le.template.get=r,le.template.set=n,le.template.configurable=o,le.template.enumerable=i,this.defineProperty(e,t,le.template)},A.defineAccessorProperty.template=F,M.value=!1,Object.defineProperty(A,"_hasUserDefinedConstructor",M),M.value=function(e,t){var r,n,o,i,a,l,c,s=this,u="undefined"==typeof this.specialize;if(e=e||Object.empty,t=t||Object.empty,e.constructor&&e.constructor.value?(r=e.constructor.value,r._hasUserDefinedConstructor=!0):this._hasUserDefinedConstructor?r=function(){return this["super"]()||this}:(r=function(){return this},r.name=this.name+"Specialized"),E)r.__proto__=s;else{for(o=Object.getOwnPropertyNames(s),l=0,c=o.length;l<c;l++)i=o[l],N.hasOwnProperty(i)||(a=Object.getOwnPropertyDescriptor(r,i),a&&!a.configurable||A.defineProperty(r,i,Object.getOwnPropertyDescriptor(s,i)));r.__constructorProto__=s,A.defineProperty(r,"isPrototypeOf",{value:function(e){for(var t;null!==e;){if(t=Object.getPrototypeOf(e),t===this)return!0;e=t}return!1},enumerable:!1})}if(n=Object.create(this.prototype),u){for(o=Object.getOwnPropertyNames(A),l=0,c=o.length;l<c;l++)i=o[l],a=Object.getOwnPropertyDescriptor(r,i),a&&!a.configurable||A.defineProperty(r,i,Object.getOwnPropertyDescriptor(A,i));for(o=Object.getOwnPropertyNames(A.prototype),l=0,c=o.length;l<c;l++)i=o[l],a=Object.getOwnPropertyDescriptor(r,i),a&&!a.configurable||A.defineProperty(n,i,Object.getOwnPropertyDescriptor(A.prototype,i))}return"objectDescriptor"in e&&A.defineProperty(r,"objectDescriptor",e.objectDescriptor),"blueprint"in e&&A.defineProperty(r,"blueprint",e.blueprint),"objectDescriptorModuleId"in e&&A.defineProperty(r,"objectDescriptorModuleId",e.objectDescriptorModuleId),"blueprintModuleId"in e&&A.defineProperty(r,"blueprintModuleId",e.blueprintModuleId),A.defineProperties(n,e,!0),A.defineProperties(r,t,!0),A.defineProperty(r,"__isConstructor__",{value:!0,enumerable:!1}),r.prototype=n,A.defineValueProperty(n,"constructor",r,!0,!1,!0),A.defineValueProperty(r,"constructor",r,!0,!1,!0),r},M.writable=!1,M.configurable=!0,M.enumerable=!1,Object.defineProperty(A,"specialize",M),!E){var S=Object.getPrototypeOf;Object.getPrototypeOf=function(e){return typeof e===_&&e.__constructorProto__?e.__constructorProto__:S.apply(Object,arguments)}}var k={enumerable:!0,configurable:!0,serializable:!0},V={writable:!0,enumerable:!0,configurable:!0,serializable:"reference"},R={writable:!0,enumerable:!1,configurable:!0},T="_serializableAttributeProperties";Object.defineProperty(A.prototype,T,{enumerable:!1,configurable:!1,writable:!0,value:{}});var q=new d,J=new d;M.writable=M.configurable=M.enumerable=!1,M.value=function(e,t,r,o){if("object"!=typeof e&&typeof e!==_||null===e)throw new TypeError("Object must be an object, not '"+e+"'");var a=m in r;if(j in r&&!a)throw new TypeError("Cannot use distinct attribute on non-value property '"+t+"'");if(v in r)r.__proto__=a?typeof r.value===_?R:V:k;else{var l;l=a?typeof r.value===_?R:V:k;for(var c in l)I.call(l,c)&&(c in r||(r[c]=l[c]))}return I.call(r,P)||t.charCodeAt(0)!==w||(r.enumerable=!1),I.call(r,O)||(r.enumerable?r.get&&!r.set?r.serializable=!1:r.writable===!1&&(r.serializable=!1):r.serializable=!1),O in r&&(n(e,O)[t]=r.serializable),o||i(e,t,r),Object.defineProperty(e,t,r)},Object.defineProperty(A,"defineProperty",M),Object.defineProperty(A,"defineProperties",{value:function(e,t,r){if("object"!=typeof t||null===t)throw new TypeError("Properties must be an object, not '"+t+"'");for(var n,o=Object.getOwnPropertyNames(t),i=0;n=o[i];i++)"_bindingDescriptors"!==n&&this.defineProperty(e,n,t[n],r);return e}}),A.defineProperty(A,"didCreate",{value:Function.noop});var U=[];A.defineProperty(A,"super",{value:s,enumerable:!1}),A.defineProperty(A.prototype,"super",{value:s,enumerable:!1}),A.defineProperty(A,"superForValue",{value:u,enumerable:!1}),A.defineProperty(A.prototype,"superForValue",{value:u,enumerable:!1}),A.defineProperty(A,"superForGet",{value:p,enumerable:!1}),A.defineProperty(A.prototype,"superForGet",{value:p,enumerable:!1}),A.defineProperty(A,"superForSet",{value:f,enumerable:!1}),A.defineProperty(A.prototype,"superForSet",{value:f,enumerable:!1}),A.defineProperty(A,"getSerializablePropertyNames",{value:function(e){var t,r=n(e,O);if(r){t=[];for(var o in r)r[o]&&t.push(o);return t}return Array.empty}}),A.defineProperty(A,"getPropertyAttribute",{value:function(e,t,r){var o=n(e,r);if(o)return o[t]}}),A.defineProperty(A,"getPropertyAttributes",{value:function(e,t){var r,o=n(e,t);if(o){r={};for(var i in o)I.call(o,i)?r[i]=o[i]:r[i]=o[i];return r}}});var G={isInstance:{value:!0}},H={objectName:{value:"Function"},isInstance:{value:!0}};Object.defineProperty(A.prototype,"_montage_metadata",{enumerable:!1,writable:!0,value:void 0}),A.defineProperty(A,"getInfoForObject",{value:function(e){var t,r;if(I.call(e,"_montage_metadata")&&e._montage_metadata)return e._montage_metadata;if(t=e._montage_metadata||e.constructor&&e.constructor._montage_metadata||null,r=e.constructor===Function?H:G,e===Object.prototype)return Object.create(t,r);try{return e.constructor===Object?Object.defineProperty(e,"_montage_metadata",{enumerable:!1,writable:!0,value:Object.create(t,r)})._montage_metadata:("_montage_metadata"in e.constructor.prototype||hasOwnProperty.call(e.constructor.prototype,"_montage_metadata")||Object.defineProperty(e.constructor.prototype,"_montage_metadata",{enumerable:!1,writable:!0,value:void 0}),(e._montage_metadata=Object.create(t,r))||e._montage_metadata)}catch(n){return e._montage_metadata=Object.create(t,r)}}}),A.defineProperty(A,"identifier",{value:null,serializable:!0}),A.defineProperty(A.prototype,"identifier",{value:null,serializable:!0}),A.defineProperty(A.prototype,"version",{value:1,serializable:!1}),A.defineProperty(A.prototype,"equals",{value:function(e){return!!e&&(this===e||this.uuid&&this.uuid===e.uuid)}}),A.defineProperty(A,"equals",{value:A.prototype.equals}),A.defineProperty(A.prototype,"callDelegateMethod",{value:function(e){var t,r=this.delegate;if(r){var n=this.identifier+e.toCapitalized();if("string"==typeof this.identifier&&typeof r[n]===_?t=r[n]:typeof r[e]===_&&(t=r[e]),t)return 2===arguments.length?t.call(r,arguments[1]):3===arguments.length?t.call(r,arguments[1],arguments[2]):4===arguments.length?t.call(r,arguments[1],arguments[2],arguments[3]):5===arguments.length?t.call(r,arguments[1],arguments[2],arguments[3],arguments[4]):(D.shift.call(arguments),t.apply(r,arguments))}}});var W=e("collections/listen/property-changes");Object.addEach(A,W.prototype),Object.addEach(A.prototype,W.prototype);var X=t.Bindings=e("frb"),$={defineBinding:{value:function(e,t,r){return X.defineBinding(this,e,t,r)}},defineBindings:{value:function(e,t){return X.defineBindings(this,e,t)}},cancelBinding:{value:function(e){return X.cancelBinding(this,e)}},cancelBindings:{value:function(){return X.cancelBindings(this)}},getBinding:{value:function(e){return X.getBinding(this,e)}},getBindings:{value:function(){return X.getBindings(this)}}};A.defineProperties(A,$),A.defineProperties(A.prototype,$);var K=e("frb/parse"),Q=e("frb/evaluate"),Y=e("frb/assign"),Z=(e("frb/bind"),e("frb/compile-observer")),ee=e("frb/scope"),te=e("frb/observers"),re=te.autoCancelPrevious,ne=function(){return this._willChangeListeners=null,this._changeListeners=null,this};Object.defineProperties(ne.prototype,{_willChangeListeners:{value:null,writable:!0},willChangeListeners:{get:function(){return this._willChangeListeners||(this._willChangeListeners=new d)}},_changeListeners:{value:null,writable:!0},changeListeners:{get:function(){return this._changeListeners||(this._changeListeners=new d)}}});var oe=new b,ie={getPath:{value:function(e,t,r,n){return Q(e,this,t||this,r,n)}},setPath:{value:function(e,t,r,n,o){return Y(this,e,t,r||this,n,o)}},observePath:{value:function(e,t){var r=K(e),n=Z(r);return n(re(t),new ee(this))}},addRangeAtPathChangeListener:{value:function(e,t,r,n,o,i){function a(e,n,o){if(t[r])t[r](e,n,o);else{if(!t.call)throw new Error("Can't dispatch range change to "+t);t.call(null,e,n,o)}}r=r||"handleRangeChange";var l=[];return this.addPathChangeListener(e,function(e){return e&&e.toArray&&e.addRangeChangeListener?(a(e.toArray(),l.toArray(),0),l=e,e.addRangeChangeListener(a)):(e=[],a(e,l,0),l=e,void 0)},void 0,void 0,n,o,i)}},getPathChangeDescriptors:{value:function(){return oe.has(this)||oe.set(this,new d),oe.get(this)}},getPathChangeDescriptor:{value:function(e,t,r){var n=A.getPathChangeDescriptors.call(this);return n.has(e)||n.set(e,new ne),n=n.get(e),n=r?n.willChangeListeners:n.changeListeners,n.has(t)||n.set(t,{path:e,handler:t,beforeChange:r,cancel:Function.noop}),n.get(t)}},addPathChangeListener:{value:function(e,t,r,n,o,i,a){var l=this;t=t||Function.noop;var c=A.getPathChangeDescriptor.call(this,e,t,n);c.cancel();var s,u,p,f=K(e);if(t===Function.noop)p=function(t){if(u)throw new Error("Path change handler needs a handler because it emits new values when the source changes: "+JSON.stringify(e));u=!0,s=t};else if(r)p=function(n){return t[r].call(t,n,e,l)};else if(t.handlePathChange)p=function(r){return t.handlePathChange.call(t,r,e,l)};else{if(typeof t!==_)throw new Error("Can't recognize handler type: "+t+". Must be function or delegate implementing handlePathChange.");p=function(r){return t.call(l,r,e,l)}}var d=Z(f),b=new ee(this);b.beforeChange=n,b.parameters=o,b.document=i,b.components=a;var h=d(re(p),b);return c.cancel=h,u?s:h}},removePathChangeListener:{value:function(e,t,r){t=t||Function.noop;var n=A.getPathChangeDescriptors.call(this),o=r?"willChangeListeners":"changeListeners",i=n.get(e);if(!i)throw new Error("Can't find "+o+" for "+JSON.stringify(e));var a=i[o];if(!a.has(t))throw new Error("Can't find "+o+" for "+JSON.stringify(e));var l=a.get(t);l.cancel(),a["delete"](t),0===i.willChangeListeners.size&&0===i.changeListeners.size&&n["delete"](e),n.size<1&&oe["delete"](this)}},addBeforePathChangeListener:{value:function(e,t,r,n,o,i){return A.addPathChangeListener.call(this,e,t,r,!0,n,o,i)}},removeBeforePathChangeListener:{value:function(e,t,r){return A.removePathChangeListener.call(this,e,t,!0)}}};A.defineProperties(A,ie),A.defineProperties(A.prototype,ie),t._objectDescriptorModuleIdDescriptor={serializable:!1,enumerable:!1,get:function(){var e=A.getInfoForObject(this),t=e&&!e.isInstance?this:this.constructor;if(!Object.getOwnPropertyDescriptor(t,"_objectDescriptorModuleId")||!t._objectDescriptorModuleId){e=A.getInfoForObject(t);var r=e.moduleId,n=r.lastIndexOf("/"),o=r.lastIndexOf(".");n=n===-1?0:n+1,o=o===-1?r.length:o,o=o<n?r.length:o,A.defineProperty(t,"_objectDescriptorModuleId",{enumerable:!1,value:r.slice(0,o)+".mjson"})}return t._objectDescriptorModuleId}},t._blueprintModuleIdDescriptor={serializable:!1,enumerable:!1,get:function(){var e=A.getInfoForObject(this),t=e&&!e.isInstance?this:this.constructor;if(!Object.getOwnPropertyDescriptor(t,"_objectDescriptorModuleId")||!t._objectDescriptorModuleId){e=A.getInfoForObject(t);var r=e.moduleId,n=r.lastIndexOf("/"),o=r.lastIndexOf(".");n=n===-1?0:n+1,o=o===-1?r.length:o,o=o<n?r.length:o,A.defineProperty(t,"_objectDescriptorModuleId",{enumerable:!1,value:r.slice(0,o)+".meta"})}return t._objectDescriptorModuleId}},t._objectDescriptorDescriptor={serializable:!1,enumerable:!1,get:function(){var r=A.getInfoForObject(this),n=r&&!r.isInstance?this:this.constructor;if(!Object.getOwnPropertyDescriptor(n,"_objectDescriptor")||!n._objectDescriptor){var o=n.objectDescriptorModuleId||n.blueprintModuleId;if(!o)throw new TypeError("ObjectDescriptor moduleId undefined for the module '"+JSON.stringify(n)+"'");t._objectDescriptorDescriptor.ObjectDescriptorModulePromise||(t._objectDescriptorDescriptor.ObjectDescriptorModulePromise=e.async("core/meta/module-object-descriptor").get("ModuleObjectDescriptor")),A.defineProperty(n,"_objectDescriptor",{enumerable:!1,value:t._objectDescriptorDescriptor.ObjectDescriptorModulePromise.then(function(e){var t=A.getInfoForObject(n);return e.getObjectDescriptorWithModuleId(o,t.require)["catch"](function(t){if(t.message.indexOf("Can't XHR")!==-1)return e.createDefaultObjectDescriptorForObject(n).then(function(e){return e});throw t})})})}return n._objectDescriptor},set:function(t){var r,n=A.getInfoForObject(this),o=n&&!n.isInstance?this:this.constructor;if(null===t)r=null;else{if(typeof t.then===_)throw new TypeError("Object descriptor should not be a promise");t.objectDescriptorInstanceModule=o.objectDescriptorModule,r=e("./promise").Promise.resolve(t)}A.defineProperty(o,"_objectDescriptor",{enumerable:!1,value:r})}},t._blueprintDescriptor=t._objectDescriptorDescriptor,e("./serialization/bindings")}});